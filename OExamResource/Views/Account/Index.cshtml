@{
    ViewBag.Title = "欢迎使用教学资源网";
    Layout = null;
}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>公共教学素材资源库--登录界面</title>
    <script src="@Url.Content("~/Scripts/jquery/jquery.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/common/json2.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/plugin/jtemplates/jquery-jtemplates.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/common/common.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/common/sync.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/plugin/artDialog/jquery.artDialog.js?skin=idialog")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/plugin/artDialog/artDialogExt.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/plugin/My97DatePicker/WdatePicker.js")" type="text/javascript"></script>
    <script type="text/javascript">
        var datareginit;
        function bindSchool(e) {
            var html = "<option value='00000000-0000-0000-0000-000000000000'>请选择</option>";
            switch ($(e).attr("id")) {
                case "ddlSchool0":
                    var _school = datareginit[e.selectedIndex].List;
                    for (var i = 0; i < _school.length; i++) {
                        html += "<option value='" + _school[i].Id + "'>" + _school[i].Name + "</option>";
                    }
                    $("#ddlSchool1").html(html).change();
                    break;
                case "ddlSchool1":
                    if (e.selectedIndex > 0) {
                        var _school = datareginit[$("#ddlSchool0").get(0).selectedIndex].List[e.selectedIndex - 1].List;
                        for (var i = 0; i < _school.length; i++) {
                            html += "<option value='" + _school[i].Id + "'>" + _school[i].Name + "</option>";
                        }
                    }
                    $("#ddlSchool2").html(html);
                    break;
                default:
            }
        }
        function sync_login() {
            var par = {};
            par.name = $("#txtLoginName").val();
            par.pwd = $("#txtLoginPwd").val();
            par.path = window.location.pathname.split("/")[1] || "";
            if (par.name && par.pwd) {
                $.sync.ajax.post("/Account/Login", par, function (data) {
                    $("#txtLoginPwd").val("");
                    $.dialog.tips(data.Msg,3);
                    if (data.State == 1) {
                        window.location.href = '/' + (data.Result.Modules[0] || '');
                        art.dialog.list['Confirm'].close();
                    } else if (data.State == 2) {
                        window.location.href = data.Result;
                    }
                });
            } else {
                $.dialog.tips("账号和密码不可为空");
            }
        }
        $(function () {
            $('#btn_login').click(function () {
                sync_login();
            });
            $('#txtLoginName,#txtLoginPwd').keypress(function (e) {
                if (e.keyCode == 13) { sync_login(); }
            });
            $("#btn_reg").click(function () {
                $.sync.ajax.post("/Account/RegInit", {}, function (data) {
                    if (data.State) {
                        $("#acc_reg").setTemplateURL("/Scripts/template/home/reginit.htm");
                        $("#acc_reg").processTemplate(data.Result);
                        datareginit = data.Result.School;
                        $("#ddlSchool0").change();
                        $.artDialog.confirm(document.getElementById('acc_reg'), function () {
                            var par = {};
                            par.LoginName = $("#txtRegId").val().trim();
                            par.LoginPwd = $("#txtRegPwd").val().trim();
                            par.LoginPwd2 = $("#txtRegPwd2").val().trim();
                            par.Name = $("#txtRegName").val().trim();
                            par.Sex = $("#rbRegMan").prop("checked") ? "男" : "女";
                            par.Birthday = $("#txtRegBirthday").val().trim();
                            par.SchoolId = $("#ddlSchool0").val();
                            par.FacultyId = $("#ddlSchool1").val();
                            par.DepartmentId = $("#ddlSchool2").val();
                            par.ProfessionId = $("#ddlzy").val();
                            par.PostId = $("#ddlzw").val();
                            par.JobId = $("#ddlzc").val();
                            par.Email = $("#txtRegEmail").val().trim();
                            par.Phone = $("#txtRegPhone").val().trim();
                            par.Type = $("#rbRegDefault").prop("checked") ? 1 : 0;
                            if (par.LoginName == "") {
                                $.artDialog.tips("账号必须填写");
                                return false;
                            }
                            if (par.LoginPwd == "") {
                                $.artDialog.tips("密码必须填写");
                                return false;
                            }
                            if (par.LoginPwd != par.LoginPwd2) {
                                $.artDialog.tips("密码有误");
                                return false;
                            }
                            if (par.Name == "") {
                                $.artDialog.tips("姓名必须填写");
                                return false;
                            }
                            $.sync.ajax.post("/Account/RegPost", par, function (data) {
                                $.artDialog.tips(data.Msg);
                                if (!data.State) {
                                    return false;
                                } else {

                                }
                            });
                            return false;
                        }, null, "none").title("注册新用户");
                    } else {
                        $.artDialog.tips(data.Msg);
                    }
                });
            });
        });
    </script>
    <style type="text/css">
        body
        {
            margin-top: 0px;
            margin-left: auto;
            margin-right: auto;
            background-image: url(images/bg.jpg);
            background-repeat: no-repeat;
            background-position: center top;
            width: 960px;
            font-size: 12px;
            font-family: Arial, Helvetica, sans-serif;
        }
        .head
        {
            padding-top: 85px;
            text-align: right;
        }
        #login
        {
            width: 185px;
            margin-left: 600px;
            margin-top: 205px;
        }
        #login td
        {
            padding-bottom: 20px;
        }
        .input01
        {
            background-image: url(images/login1.jpg);
            width: 90px;
            height: 35px;
            border: none;
        }
        .input02
        {
            background-image: url(images/login2.jpg);
            width: 75px;
            height: 28px;
            border: solid 0px #FFF;
        }
        .red
        {
            color: Red;
        }
    </style>
</head>
<body>
    <div class="head">
        @{
            if (ViewBag.Name == null)
            {
            <span>您的IP是：@HttpContext.Current.Request.UserHostAddress，如无法登录请致电</span>
            }
            else
            {
                if (ViewBag.SchoolEnd == true)
                {
                     <span style="color:Red">系统检测到您的IP属于<b>@(ViewBag.Name)</b>，已到期，请致电天演公司</span>
                
                }else{
                 <span>系统检测到您的IP属于<b>@(ViewBag.Name)</b>，<span id='sp_time'>2</span>秒后<a href="@ViewBag.Url" class="red">自动跳转</a>。如无法登录请致电</span>
                 <script type="text/javascript">
                         var timer = setInterval(function () {
                                   if ($('#sp_time').text() <= 1) {
                                        window.location.href = '@ViewBag.Url';
                                        clearInterval(timer);
                                         }
                          $('#sp_time').text($('#sp_time').text() - 1);
                  }, 1000);
                 </script>
                }
            }
        }
    </div>
    <table width="100%" border="0" cellspacing="0" cellpadding="0" id="login">
        <tr>
            <td>
                用户名
            </td>
            <td>
                <input name="yhm" id="txtLoginName" type="text" value="" size="17" />
            </td>
        </tr>
        <tr>
            <td>
                密&nbsp;&nbsp;码
            </td>
            <td>
                <input name="yhm" id="txtLoginPwd" type="password" value="" size="17" />
            </td>
        </tr>
        <tr>
            <td colspan="2">
                <table width="100%" border="0" cellspacing="0" cellpadding="0" style="height: 35px;
                    vertical-align: top; margin-top: 5px;">
                    <tr>
                        <td align="left">
                            <input name="dl" type="button" value="" class="input01" id="btn_login" />
                        </td>
                        <td align="right">
                            <input name="dl" type="button" value="" class="input02" id="btn_reg" />
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
  
    <div id="acc_reg" style="display: none;">
    </div>
</body>
</html>
