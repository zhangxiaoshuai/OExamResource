$.extend({ cellpagebar: {} }); $.cellpagebar = { init: function (a, b) { a.text = jQuery.ajax({ url: a.template || "/Scripts/plugin/cellpagebar/template.htm", async: false }).responseText; a.arr = a.text.match(/\{#(.+)#\}/g); a.strcell = a.arr[0].replace("{#", "").replace("#}", ""); a.pagecount = Math.ceil(a.total / a.pagesize); if (a.pagecount <= 0) { a.container.html("Sync没有检测到数据。"); b(-1); return false } a.barcount = a.barcount || 9; a.container = a.container; a.strcells = ""; for (var c = 1; c <= Math.min(a.barcount, a.pagecount); c++) { a.strcells += a.strcell.format(c) } a.text = a.text.replace(/\{#.+#\}/g, a.strcells); a.text = String.format(a.text, a.pagecount); a.container.html(a.text); a.container.children(".pagecell").off().on("click", function () { $.cellpagebar.pageClick($(this).attr("data"), a, b) }); a.container.children("#pagefirst").unbind().bind("click", function () { $.cellpagebar.pageClick(1, a, b) }); a.container.children("#pagelast").unbind().bind("click", function () { $.cellpagebar.pageClick(a.pagecount, a, b) }); a.container.children("#pageprev").unbind().bind("click", function () { var d = parseInt(a.container.children(".pagecurrent").attr("data")) - 1; if (d < 1) { return false } a.container.children(".pagecell[data=" + d + "]").click() }); a.container.children("#pagenext").unbind().bind("click", function () { var d = parseInt(a.container.children(".pagecurrent").attr("data")) + 1; if (d > a.pagecount) { return false } a.container.children(".pagecell[data=" + d + "]").click() }); a.container.children("#pagego").unbind().bind("click", function () { var d = a.container.children("#pageindex").val(); if (isNaN(d)) { d = a.container.children(".pagecurrent").attr("data") } else { if (d < 1) { d = 1 } else { if (d > a.pagecount) { d = a.pagecount } } } a.container.children("#pageindex").val(d); $.cellpagebar.pageClick(d, a, b) }); if (!a.pageindex || isNaN(a.pageindex)) { a.container.children(".pagecell:first").click() } else { if (a.pageindex < 1) { a.pageindex = 1 } else { if (a.pageindex > a.pagecount) { a.pageindex = a.pagecount } } a.container.children("#pageindex").val(a.pageindex); $.cellpagebar.pageClick(a.pageindex, a, b) } }, pageClick: function (h, d, e) { var k = d.container.children(".pagecell[data=" + h + "]"); if (k.hasClass("pagecurrent")) { return false } var c = 0; var a = 0; if (h - Math.ceil(d.barcount / 2) + 1 >= 1 && h - Math.ceil(d.barcount / 2) + d.barcount <= d.pagecount) { c = h - Math.ceil(d.barcount / 2) + 1; a = h - Math.ceil(d.barcount / 2) + d.barcount } else { if (h < Math.ceil(d.barcount / 2)) { c = 1; a = (d.barcount > d.pagecount ? d.pagecount : d.barcount) } else { c = ((d.pagecount - d.barcount) < 1 ? 1 : (d.pagecount - d.barcount + 1)); a = d.pagecount } } var b = d.container.children(".pagecell"); var g = 0; for (var f = c; f <= a; f++) { b.eq(g).replaceWith(d.strcell.format(f)); g++ } d.container.children(".pagecell").unbind().bind("click", function () { $.cellpagebar.pageClick($(this).attr("data"), d, e) }); d.container.children("#pageindex").val(h); d.container.children(".pagecell[data=" + h + "]").addClass("pagecurrent").siblings().removeClass("pagecurrent"); e(h) } };